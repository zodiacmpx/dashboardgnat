<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Operaciones Unificado - Dashboard</title>
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Iconos FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #003366; /* Azul corporativo oscuro */
            --secondary-color: #005596; /* Azul más claro */
            --accent-color: #FF6600; /* Naranja Saesa */
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --bg-color: #f4f6f9;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-radius: 8px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        body { background-color: var(--bg-color); color: var(--text-color); }

        /* HEADER & FILTROS */
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo-section h2 { font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .logo-section i { color: var(--accent-color); }

        .filters { display: flex; gap: 10px; }
        
        select, button.action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.2);
            background-color: rgba(255,255,255,0.1);
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        select:hover { background-color: rgba(255,255,255,0.2); }
        option { background-color: var(--primary-color); }

        .action-btn {
            background-color: var(--success-color);
            border: none;
            font-weight: bold;
        }
        .action-btn:hover { background-color: #218838; }

        /* KPI CARDS (TOP ROW) */
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 15px;
        }

        .kpi-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-top: 3px solid transparent;
        }
        
        .kpi-card.blue { border-color: var(--secondary-color); }
        .kpi-card.green { border-color: var(--success-color); }
        .kpi-card.orange { border-color: var(--accent-color); }
        .kpi-card.red { border-color: var(--danger-color); }

        .kpi-value { font-size: 1.8rem; font-weight: bold; color: var(--text-color); }
        .kpi-label { font-size: 0.8rem; color: #666; text-transform: uppercase; letter-spacing: 0.5px; }

        /* MAIN LAYOUT GRID */
        .main-grid {
            display: grid;
            grid-template-columns: 250px 1fr 280px; /* Sidebar Izq | Central | Sidebar Der */
            gap: 15px;
            padding: 0 15px 15px 15px;
            height: calc(100vh - 140px);
        }

        /* GENERAL CARD STYLES */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        /* COLUMNA IZQUIERDA */
        .list-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.85rem;
        }
        .list-item:last-child { border-bottom: none; }
        .badge { padding: 2px 6px; border-radius: 10px; font-size: 0.75rem; color: white; font-weight: bold; }
        .badge.red { background-color: var(--danger-color); }
        .badge.orange { background-color: var(--accent-color); }

        /* GAUGE CHART CONTAINER */
        .gauge-container { height: 120px; position: relative; }
        
        /* TABLA BRIGADAS */
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        th { text-align: left; color: #666; font-weight: 600; padding: 5px; }
        td { padding: 6px 5px; border-bottom: 1px solid #f0f0f0; }
        .progress-bar-bg { width: 100%; background: #eee; height: 6px; border-radius: 3px; margin-top: 4px; }
        .progress-bar-fill { height: 100%; border-radius: 3px; }

        /* COLUMNA CENTRAL */
        .chart-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; height: 200px; }
        .table-container { flex-grow: 1; overflow-y: auto; }
        
        .status-pill {
            padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;
        }
        .status-pill.multable { background: #fee2e2; color: #991b1b; } /* Rojo suave */
        .status-pill.normal { background: #d1fae5; color: #065f46; } /* Verde suave */
        .status-pill.pendiente { background: #fef3c7; color: #92400e; } /* Amarillo suave */

        /* COLUMNA DERECHA */
        .calendar-mini { width: 100%; font-size: 0.75rem; text-align: center; }
        .calendar-mini th { text-align: center; background: #f8f9fa; }
        .calendar-mini td { padding: 4px; cursor: pointer; }
        .calendar-mini td:hover { background: #e9ecef; border-radius: 50%; }
        .calendar-mini .active { background: var(--accent-color); color: white; border-radius: 50%; }
        
        .alert-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #fff5f5;
            border-left: 3px solid var(--danger-color);
            margin-bottom: 5px;
            font-size: 0.8rem;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .main-grid { grid-template-columns: 250px 1fr; }
            .right-sidebar { display: none; } /* Ocultar sidebar der en pantallas medianas o mover abajo */
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <div class="header">
        <div class="logo-section">
            <h2><i class="fa-solid fa-bolt"></i> Grupo Saesa | COU</h2>
        </div>
        <div class="filters">
            <!-- EJEMPLOS DE SEGMENTADORES ÚTILES -->
            <select id="zonaFilter" onchange="actualizarDashboard()">
                <option value="all">Zonal: Todas</option>
                <option value="valdivia">Zonal Valdivia</option>
                <option value="osorno">Zonal Osorno</option>
                <option value="ptomontt">Zonal Pto. Montt</option>
                <option value="chiloe">Zonal Chiloé</option>
            </select>
            
            <select id="comunaFilter">
                <option value="all">Comuna: Todas</option>
                <!-- Se llenarían dinámicamente con JS -->
                <option value="c1">Valdivia Centro</option>
                <option value="c2">Corral</option>
            </select>

            <select id="brigadaFilter">
                <option value="all">Tipo Brigada: Todas</option>
                <option value="liviana">Brigada Liviana</option>
                <option value="pesada">Brigada Pesada</option>
                <option value="roce">Brigada de Roce</option>
            </select>

            <select id="estadoFilter">
                <option value="all">Estado: Todos</option>
                <option value="pendiente">Pendientes</option>
                <option value="curso">En Curso</option>
                <option value="cerrado">Cerrados</option>
            </select>

            <button class="action-btn"><i class="fa-solid fa-plus"></i> Levantar Incidencia</button>
        </div>
    </div>

    <!-- KPI TOP ROW -->
    <div class="kpi-container">
        <div class="kpi-card blue">
            <div class="kpi-value">446</div>
            <div class="kpi-label">Tareas Asignadas</div>
        </div>
        <div class="kpi-card green">
            <div class="kpi-value">106.9%</div>
            <div class="kpi-label">Eficiencia Operativa</div>
        </div>
        <div class="kpi-card orange">
            <div class="kpi-value">26</div>
            <div class="kpi-label">Prioritarios Hoy</div>
        </div>
        <div class="kpi-card blue">
            <div class="kpi-value">231</div>
            <div class="kpi-label">Total en Bandeja</div>
        </div>
        <div class="kpi-card red">
            <div class="kpi-value">25</div>
            <div class="kpi-label">Índice PT Diario</div>
        </div>
        <div class="kpi-card blue">
            <div class="kpi-value">21.6</div>
            <div class="kpi-label">Días Promedio</div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-grid">
        
        <!-- COLUMNA 1: ESTADO OPERACIONAL -->
        <div class="col-left">
            <!-- Fallas Pendientes -->
            <div class="card" style="height: auto;">
                <div class="card-header">
                    <span><i class="fa-solid fa-triangle-exclamation"></i> Fallas Pendientes</span>
                </div>
                <div class="list-item"><span>Valdivia</span> <span class="badge red">28</span></div>
                <div class="list-item"><span>Pto. Montt</span> <span class="badge red">23</span></div>
                <div class="list-item"><span>Malleco</span> <span class="badge orange">14</span></div>
                <div class="list-item"><span>Osorno</span> <span class="badge orange">13</span></div>
            </div>

            <!-- Complejidad Operacional (Gauge) -->
            <div class="card">
                <div class="card-header">Complejidad Operacional</div>
                <div class="gauge-container">
                    <canvas id="gaugeChart"></canvas>
                </div>
                <div style="text-align: center; font-weight: bold; color: orange; margin-top: -10px;">MEDIA-ALTA</div>
                <div style="text-align: center; font-size: 0.7rem; color: #666;">Factores: Clima, Tráfico</div>
            </div>

            <!-- Estado Brigadas -->
            <div class="card" style="flex-grow: 1;">
                <div class="card-header">Estado Brigadas</div>
                <table>
                    <thead>
                        <tr>
                            <th>Brigada</th>
                            <th>Efic.</th>
                            <th>Ocup.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>BBOO 2157</td>
                            <td>
                                0%
                                <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: 0%; background: #ccc;"></div></div>
                            </td>
                            <td>0%</td>
                        </tr>
                        <tr>
                            <td>BBOO T99</td>
                            <td>
                                31%
                                <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: 31%; background: #dc3545;"></div></div>
                            </td>
                            <td>12%</td>
                        </tr>
                        <tr>
                            <td>BBOO 2092</td>
                            <td>
                                98%
                                <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: 98%; background: #28a745;"></div></div>
                            </td>
                            <td>88%</td>
                        </tr>
                         <tr>
                            <td>BBOO T59</td>
                            <td>
                                64%
                                <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: 64%; background: #ffc107;"></div></div>
                            </td>
                            <td>50%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- COLUMNA 2: ANÁLISIS Y GESTIÓN -->
        <div class="col-center">
            
            <!-- Fila de Gráficos -->
            <div class="chart-row">
                <!-- Tiempo Improductivo -->
                <div class="card" style="margin-bottom: 0;">
                    <div class="card-header">Tiempo Improductivo (min)</div>
                    <canvas id="barChart"></canvas>
                </div>
                <!-- Distribución Tareas -->
                <div class="card" style="margin-bottom: 0;">
                    <div class="card-header">Distribución Tareas</div>
                    <canvas id="doughnutChart"></canvas>
                </div>
            </div>

            <!-- Minuta Comercial -->
            <div class="card table-container" style="max-height: 250px;">
                <div class="card-header">
                    <span>Minuta Asignación Comercial</span>
                    <span class="badge" style="background:var(--primary-color)">En Proceso</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Tarea</th>
                            <th>Tipo</th>
                            <th>Días Ant.</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0018687...</td>
                            <td>Contrato BT1</td>
                            <td><span class="badge red">12</span></td>
                            <td><span class="status-pill multable">Multable</span></td>
                        </tr>
                        <tr>
                            <td>0018018...</td>
                            <td>Contrato BT1</td>
                            <td><span class="badge red">11</span></td>
                            <td><span class="status-pill multable">Multable</span></td>
                        </tr>
                        <tr>
                            <td>0018732...</td>
                            <td>Contrato BT1</td>
                            <td><span class="badge orange">9</span></td>
                            <td><span class="status-pill multable">Riesgo</span></td>
                        </tr>
                        <tr>
                            <td>0018796...</td>
                            <td>Conexión</td>
                            <td><span class="badge" style="background:#007bff">3</span></td>
                            <td><span class="status-pill normal">Normal</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Gestión PT -->
            <div class="card table-container" style="flex-grow: 1;">
                <div class="card-header">
                    <span>Gestión y Análisis PT</span>
                    <span class="badge orange">Pendiente</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Caso</th>
                            <th>Inicio</th>
                            <th>Jerarquía</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Planif. Acotada</td>
                            <td>40906970</td>
                            <td>10:00</td>
                            <td>Tucapel</td>
                        </tr>
                        <tr>
                            <td>Planif. Forestal</td>
                            <td>40932539</td>
                            <td>10:00</td>
                            <td>Quilaco</td>
                        </tr>
                        <tr style="background-color: #fff0f0;">
                            <td>PT DX Tipo A</td>
                            <td>40924777</td>
                            <td>11:15</td>
                            <td>Las Hortencias</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- COLUMNA 3: DETALLES Y ALERTAS -->
        <div class="col-right">
            <!-- Calendario -->
            <div class="card">
                <div class="card-header">Calendario PT - Dic 25</div>
                <table class="calendar-mini">
                    <thead><tr><th>L</th><th>M</th><th>M</th><th>J</th><th>V</th><th>S</th><th>D</th></tr></thead>
                    <tbody>
                        <tr><td></td><td></td><td></td><td></td><td>1</td><td>2</td><td>3</td></tr>
                        <tr><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
                        <tr><td>11</td><td>12</td><td>13</td><td>14</td><td class="active">15</td><td>16</td><td>17</td></tr>
                        <tr><td>18</td><td>19</td><td>20</td><td>21</td><td>22</td><td>23</td><td>24</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Alertas -->
            <div class="card">
                <div class="card-header">Alertas & Vencimientos</div>
                <div class="alert-item">
                    <i class="fa-solid fa-clock"></i>
                    <div>
                        <strong>Próx. a Vencer</strong><br>
                        <span style="font-size:0.7rem">49 casos críticos</span>
                    </div>
                </div>
                <div class="alert-item" style="border-left-color: var(--accent-color); background: #fff8f0;">
                    <i class="fa-solid fa-triangle-exclamation" style="color:var(--accent-color)"></i>
                    <div>
                        <strong>Tareas Críticas</strong><br>
                        <span style="font-size:0.7rem">15 brigadas asignadas</span>
                    </div>
                </div>
            </div>

            <!-- Zona Crítica -->
            <div class="card">
                <div class="card-header">PT x Zona Crítica</div>
                <div class="list-item"><span>Santa Barbara</span> <strong>4</strong></div>
                <div class="list-item"><span>Lonquimay</span> <strong>3</strong></div>
                <div class="list-item"><span>Arauco</span> <strong>2</strong></div>
            </div>

            <!-- Concurrencia -->
            <div class="card" style="flex-grow: 1;">
                <div class="card-header">Concurrencia Fallas</div>
                <canvas id="concurrenceChart"></canvas>
            </div>
        </div>
    </div>

    <!-- SCRIPTS PARA GRÁFICOS -->
    <script>
        // Configuración común de estilos
        Chart.defaults.font.family = "'Segoe UI', sans-serif";
        Chart.defaults.font.size = 10;
        Chart.defaults.color = '#666';

        // 1. Gráfico Gauge (Complejidad) - Simulado con Doughnut
        new Chart(document.getElementById('gaugeChart'), {
            type: 'doughnut',
            data: {
                labels: ['Bajo', 'Medio', 'Alto'],
                datasets: [{
                    data: [30, 40, 30],
                    backgroundColor: ['#28a745', '#ffc107', '#dc3545'],
                    borderWidth: 0,
                    circumference: 180,
                    rotation: 270,
                    cutout: '75%'
                }]
            },
            options: {
                plugins: { legend: { display: false }, tooltip: { enabled: false } },
                aspectRatio: 1.5
            }
        });

        // 2. Gráfico Barras (Tiempo Improductivo)
        new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
                labels: ['Traslado', 'Espera Mat.', 'Espera Instruc.', 'Otros'],
                datasets: [{
                    label: 'Minutos',
                    data: [99, 30, 24, 5],
                    backgroundColor: '#003366',
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, grid: { display: false } }, x: { grid: { display: false } } }
            }
        });

        // 3. Gráfico Donut (Distribución Tareas)
        new Chart(document.getElementById('doughnutChart'), {
            type: 'doughnut',
            data: {
                labels: ['Reposiciones', 'Regulatorio', 'Prioritario'],
                datasets: [{
                    data: [93, 62, 26],
                    backgroundColor: ['#e83e8c', '#003366', '#fd7e14'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { position: 'right', labels: { boxWidth: 10 } } 
                },
                cutout: '60%'
            }
        });

        // 4. Gráfico Barras Vertical (Concurrencia)
        new Chart(document.getElementById('concurrenceChart'), {
            type: 'bar',
            data: {
                labels: ['Osorno', 'Cabrero', 'Vald.', 'Temuco'],
                datasets: [{
                    label: 'Fallas',
                    data: [12, 8, 5, 3],
                    backgroundColor: '#003366'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { ticks: { font: { size: 9 } } } }
            }
        });

        // Simulación de filtro
        function actualizarDashboard() {
            const zona = document.getElementById('zonaFilter').value;
            // Aquí iría la lógica para llamar al backend o filtrar los datos JS
            console.log("Filtrando por zona: " + zona);
            alert("Dashboard actualizado para zona: " + zona);
        }
    </script>
</body>
</html>

</body>
</html>
